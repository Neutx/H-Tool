# Shopify API 2026-01 - FINAL FIX: amount is a Scalar

## üéØ The Real Issue

The error `"Selections can't be made on scalars (field 'amount' returns Money but has selections ["amount", "currency"])"` means:

**In API 2026-01, `amount` is a SCALAR FIELD (a simple string) - NOT an object!**

You cannot do:
```graphql
‚ùå amount {
     amount
     currency
   }
```

---

## ‚úÖ CORRECT STRUCTURE FOR 2026-01

In the GraphQL query, change transactions from:

**WRONG:**
```graphql
transactions(first: 100) {
  edges {
    node {
      id
      amount {
        amount
        currency
      }
      status
      gateway
      processedAt
    }
  }
}
```

**CORRECT:**
```graphql
transactions(first: 100) {
  edges {
    node {
      id
      amount           # ‚úÖ Direct scalar - no selections
      currencyCode     # ‚úÖ Separate top-level field
      status
      gateway
      processedAt
    }
  }
}
```

---

## üìù Complete Fixed Query

```typescript
const query = `
  query ($first: Int!, $query: String!) {
    orders(first: $first, query: $query) {
      edges {
        node {
          id
          name
          customer {
            id
            email
            firstName
            lastName
          }
          refunds {
            id
            createdAt
            note
            refundLineItems(first: 100) {
              edges {
                node {
                  id
                  quantity
                  restockType
                  lineItem {
                    id
                    name
                    sku
                  }
                }
              }
            }
            transactions(first: 100) {
              edges {
                node {
                  id
                  amount            # ‚úÖ Scalar string
                  currencyCode      # ‚úÖ Separate field
                  status
                  gateway
                  processedAt
                }
              }
            }
          }
        }
      }
      pageInfo {
        hasNextPage
        endCursor
      }
    }
  }
`;
```

---

## üîß Update TypeScript Interface

**WRONG:**
```typescript
transactions: {
  edges: Array<{
    node: {
      id: string;
      amount: {
        amount: string;
        currency: string;
      };
      status: string;
      gateway: string;
      processedAt: string;
    };
  }>;
};
```

**CORRECT:**
```typescript
transactions: {
  edges: Array<{
    node: {
      id: string;
      amount: string;           // ‚úÖ Direct string
      currencyCode: string;     // ‚úÖ Separate field
      status: string;
      gateway: string;
      processedAt: string;
    };
  }>;
};
```

---

## üìã Update Transaction Mapping

In your refund extraction loop:

**WRONG:**
```typescript
transactions: refund.transactions.edges.map((edge: { node: { 
  id: string; 
  amount: { amount: string; currency: string };
  status: string;
  gateway: string;
  processedAt: string;
} }) => ({
  id: edge.node.id,
  amount: edge.node.amount.amount,  // ‚ùå Wrong nesting
  status: edge.node.status,
  gateway: edge.node.gateway,
  processed_at: edge.node.processedAt,
}))
```

**CORRECT:**
```typescript
transactions: refund.transactions.edges.map((edge: { node: { 
  id: string; 
  amount: string;                // ‚úÖ Direct
  currencyCode: string;          // ‚úÖ Direct
  status: string;
  gateway: string;
  processedAt: string;
} }) => ({
  id: edge.node.id,
  amount: edge.node.amount,      // ‚úÖ Direct access
  status: edge.node.status,
  gateway: edge.node.gateway,
  processed_at: edge.node.processedAt,
}))
```

---

## üß™ Test Code

```typescript
const result = await shopify.getRefunds(undefined, 10);
if (result.success) {
  console.log('‚úÖ Success! Refunds:', result.data?.refunds.edges.length);
  console.log('Sample amount:', result.data?.refunds.edges[0]?.node.transactions[0]?.amount);
} else {
  console.error('‚ùå Error:', result.error);
}
```

---

## ‚ö†Ô∏è Key Takeaway

**2026-01 Schema Change Summary:**

| Field | 2024-01 | 2026-01 |
|-------|---------|---------|
| `amount` | Object with `shopMoney` | **Direct scalar string** |
| `currencyCode` | Inside `amount.shopMoney` | **Top-level field** |
| Query | `amount { shopMoney { amount currencyCode } }` | `amount` and `currencyCode` (no nesting) |

The fix is simpler than it looks - just flatten the structure!
